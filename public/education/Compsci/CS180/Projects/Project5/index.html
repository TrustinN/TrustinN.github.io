<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fun With Diffusion Models!</title>
    <script src="/carousel.js" defer></script>
    <script src="/resetGif.js" defer></script>
    <script src="/common.js" defer></script>
    <script
      id="MathJax-script"
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
      defer
    ></script>
    <link href="/css/style.css" rel="stylesheet" />
  </head>

  <body>
    <div class="page-container include-sidebar">
      <header></header>

      <div class="banner">
        <h1>Project 5: Fun With Diffusion Models!</h1>
      </div>

      <div class="sidebar-container">
        <div class="sidebar-nav"></div>
      </div>

      <div class="content-container">
        <main>
          <section>
            <article id="Forward Process">
              <h2>Forward Process</h2>
              <p>
                In the forward process, an image is denoised by subtracting away
                the noise that is predicted to be in the image. For diffusion,
                the model is trained on the noise given by: \begin{equation*}
                \mathcal{N}(0, \sqrt{1 - \overline{\alpha}}) \end{equation*}
                Adding this noise to our base image \begin{equation*}
                \sqrt{\overline{\alpha}} \cdot x_0 \end{equation*} gives the
                noisy image that the network sees at $\alpha$, the interpolation
                factor. Here, $\alpha$ is determined by a schedule, and we
                obtain it by $\alpha[t]$ where $t$ is the timestep $t \in [0,
                999]$. Here are some results of generating the noisy image:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(4, 1fr);
                    --image-container-width: 35rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/camp_clean.png"
                      alt="Campanile Noise t0"
                    />
                    <figcaption>$t = 0$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/noise_t250.png"
                      alt="Campanile Noise t250"
                    />
                    <figcaption>$t = 250$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/noise_t500.png"
                      alt="Campanile Noise t500"
                    />
                    <figcaption>$t = 500$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/noise_t750.png"
                      alt="Campanile Noise t750"
                    />
                    <figcaption>$t = 750$</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Denoising">
              <h2>Denoising</h2>
              <h3>Classic Denoising</h3>
              <p>
                In classic denoising, we attempt to hide irregularities in the
                image through some averaging/smoothing filter such as the
                gaussian filter. By pulling data from neighboring pixels, we can
                decrease the impact of noise on the image. This does well when
                there is little noise, but fails at high noise levels, which is
                seen in all three attempts.
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(4, 1fr);
                    --image-container-width: 35rem;
                  "
                >
                  <img src="./media/camp_clean.png" alt="Campanile Noise t0" />
                  <img
                    src="./media/gaussian/noise_t250.png"
                    alt="Campanile Noise t250"
                    loading="lazy"
                  />
                  <img
                    src="./media/gaussian/noise_t500.png"
                    alt="Campanile Noise t500"
                    loading="lazy"
                  />
                  <img
                    src="./media/gaussian/noise_t750.png"
                    alt="Campanile Noise t750"
                    loading="lazy"
                  />
                  <figure>
                    <img
                      src="./media/camp_clean.png"
                      alt="Campanile Noise t0"
                    />
                    <figcaption>Original</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/clean_t250.png"
                      alt="Campanile Clean t250"
                      loading="lazy"
                    />
                    <figcaption>Denoise $t = 250$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/clean_t500.png"
                      alt="Campanile Clean t500"
                      loading="lazy"
                    />
                    <figcaption>Denoise $t = 500$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/gaussian/clean_t750.png"
                      alt="Campanile Clean t750"
                      loading="lazy"
                    />
                    <figcaption>Denoise $t = 750$</figcaption>
                  </figure>
                </div>
              </div>
              <h3>One-Step Denoising</h3>
              <p>
                In one step denoising, we feed in the noisy image and the
                current timestep, and the model recovers the amount of noise
                that is predicted to be in the image. Recall that we used the
                equation: \begin{equation*} x_{t} = \sqrt{\overline{\alpha}}
                \cdot x_{0} + \sqrt{1 - \overline{\alpha}} \cdot \epsilon
                \end{equation*} for the forward process. So we can recover the
                original image $x_0$ by: \begin{equation*} x_{0} = \dfrac{x_{t}
                - \sqrt{1 - \overline{\alpha}} \cdot
                \epsilon}{\sqrt{\overline{\alpha}}} \end{equation*}
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(4, 1fr);
                    --image-container-width: 35rem;
                  "
                >
                  <img src="./media/camp_clean.png" alt="Campanile Noise t0" />
                  <img
                    src="./media/one_step/noise_t250.png"
                    alt="Campanile Noise t250"
                    loading="lazy"
                  />
                  <img
                    src="./media/one_step/noise_t500.png"
                    alt="Campanile Noise t500"
                    loading="lazy"
                  />
                  <img
                    src="./media/one_step/noise_t750.png"
                    alt="Campanile Noise t750"
                    loading="lazy"
                  />
                  <figure>
                    <img
                      src="./media/camp_clean.png"
                      alt="Campanile Noise t0"
                    />
                    <figcaption>Original</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/one_step/clean_t250.png"
                      alt="Campanile Clean t250"
                      loading="lazy"
                    />
                    <figcaption>Denoise: $t = 250$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/one_step/clean_t500.png"
                      alt="Campanile Clean t500"
                      loading="lazy"
                    />
                    <figcaption>Denoise: $t = 500$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/one_step/clean_t750.png"
                      alt="Campanile Clean t750"
                      loading="lazy"
                    />
                    <figcaption>Denoise: $t = 750$</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                This does much better than the low-pass filter, but the image is
                till blurry compared to the original. For example, the trees
                have lost their texture and takes on a flat green texture.
              </p>
              <h3>Iterative Denoising</h3>
              <p>
                In iterative denoising, rather than subtracting all noise out in
                one step, we subtract a little bit of noise over many steps and
                repredict the next amount of noise. The process is sped up by
                taking strided timesteps and the new formula is given by:
                \begin{equation*} x_{t^{\prime}} =
                \dfrac{\sqrt{\overline{\alpha_{t^{\prime}}}}\beta_{t}}{1 -
                \overline{\alpha}_{t}}x_{0} + \dfrac{\sqrt{\alpha_{t}}(1 -
                \overline{\alpha}_{t^{\prime}})}{1 - \overline{\alpha_{t}}}x_{t}
                + v_{\sigma}\end{equation*} The values are given by:
              </p>

              <ul style="margin-left: 2rem">
                <li>$x_{t}$ is the noisy image at time $t$</li>
                <li>
                  $x_{t^{\prime}}$ is the noisy image at the next timestep
                </li>
                <li>$\overline{\alpha}_{t}$ is $\alpha[t]$</li>
                <li>
                  $\alpha_{t} =
                  \frac{\overline{\alpha}_{t}}{\overline{\alpha_{t^{\prime}}}}$
                </li>
                <li>$\beta_{t} = 1 - \alpha_{t}$</li>
                <li>
                  $x_{0}$ is the predicted clean image given by the one step
                  formula
                </li>
              </ul>
              <div class="centered">
                <div class="carousel-container" id="carousel1">
                  <button class="carousel-button" onclick="shiftLeft(1)">
                    &#9664;
                  </button>
                  <div
                    class="image-container"
                    style="
                      --grid-cols: repeat(5, 1fr);
                      --image-container-width: 40rem;
                    "
                  >
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_1.png"
                        alt="Campanile Iterative Denoise 1"
                        loading="lazy"
                      />
                      <figcaption>$t = 690$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_2.png"
                        alt="Campanile Iterative Denoise 2"
                        loading="lazy"
                      />
                      <figcaption>$t = 540$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_3.png"
                        alt="Campanile Iterative Denoise 3"
                        loading="lazy"
                      />
                      <figcaption>$t = 390$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_4.png"
                        alt="Campanile Iterative Denoise 4"
                        loading="lazy"
                      />
                      <figcaption>$t = 240$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_5.png"
                        alt="Campanile Iterative Denoise 5"
                        loading="lazy"
                      />
                      <figcaption>$t = 90$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/iterative/camp_iterative.png"
                        alt="Campanile Iterative Denoise 6"
                        loading="lazy"
                      />
                      <figcaption>$t = 0$</figcaption>
                    </figure>
                  </div>
                  <button class="carousel-button" onclick="shiftRight(1)">
                    &#9654;
                  </button>
                </div>
              </div>
              <p>The resulting image looks sharper than the previous ones</p>
              <h3>A Comparison</h3>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(4, 1fr);
                    --image-container-width: 35rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/gaussian/clean_t750.png"
                      alt="Gaussian Denoise"
                      loading="lazy"
                    />
                    <figcaption>Gaussian Denoise</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/one_step/clean_t750.png"
                      alt="One Step Denoise"
                      loading="lazy"
                    />
                    <figcaption>One Step Denoise</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/iterative/camp_iterative.png"
                      alt="Iterative Denoise"
                      loading="lazy"
                    />
                    <figcaption>Iterative Denoise</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/camp_clean.png"
                      alt="Campanile"
                      loading="lazy"
                    />

                    <figcaption>Original</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                It is noticeable that gaussian denoising is not very effective
                when there is too much noise. So we have to go for nonlinear
                denoising methods, such as one step and iterative denoising.
              </p>
            </article>
          </section>
          <section>
            <article id="Diffusion Sampling">
              <h2>Diffusion Model Sampling</h2>
              <p>
                We can also denoise pure noise, rather than starting from a
                noisy image. Here are $5$ results:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="--grid-cols: repeat(5, 1fr)"
                >
                  <img
                    src="./media/diff_sample/diff_sample_1.png"
                    alt="Diffusion Sample 1"
                    loading="lazy"
                  />
                  <img
                    src="./media/diff_sample/diff_sample_2.png"
                    alt="Diffusion Sample 2"
                    loading="lazy"
                  />
                  <img
                    src="./media/diff_sample/diff_sample_3.png"
                    alt="Diffusion Sample 3"
                    loading="lazy"
                  />
                  <img
                    src="./media/diff_sample/diff_sample_4.png"
                    alt="Diffusion Sample 4"
                    loading="lazy"
                  />
                  <img
                    src="./media/diff_sample/diff_sample_5.png"
                    alt="Diffusion Sample 5"
                    loading="lazy"
                  />
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="CFG">
              <h2>Classifier Free Guidance</h2>
              <p>
                In CFG, the model uses conditional classification. We can
                generate two noise predictions off of our current image
                $\epsilon_{c}, \epsilon_{u}$ such that our new predicted noise
                is: \begin{equation*} \epsilon = (1 - \gamma)\epsilon_{u} +
                \gamma \epsilon_{c} \end{equation*} This means that when $\gamma
                &gt; 1$ the noise prediction leans more towards using the
                conditional noise. From the small update the images become much
                more recognizable:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="--grid-cols: repeat(5, 1fr)"
                >
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/iterative_cfg/cfg1/denoise_8.png"
                        alt="iterative_cfg1_clean"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/iterative_cfg/cfg1/output.gif"
                        alt="iterative_cfg1_gif"
                        loading="lazy"
                      />
                    </div>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/iterative_cfg/cfg2/denoise_8.png"
                        alt="iterative_cfg2_clean"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/iterative_cfg/cfg2/output.gif"
                        alt="iterative_cfg2_gif"
                        loading="lazy"
                      />
                    </div>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/iterative_cfg/cfg3/denoise_8.png"
                        alt="iterative_cfg3_clean"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/iterative_cfg/cfg3/output.gif"
                        alt="iterative_cfg3_gif"
                        loading="lazy"
                      />
                    </div>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/iterative_cfg/cfg4/denoise_8.png"
                        alt="iterative_cfg4_clean"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/iterative_cfg/cfg4/output.gif"
                        alt="iterative_cfg4_gif"
                        loading="lazy"
                      />
                    </div>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/iterative_cfg/cfg5/denoise_8.png"
                        alt="iterative_cfg5_clean"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/iterative_cfg/cfg5/output.gif"
                        alt="iterative_cfg5_gif"
                        loading="lazy"
                      />
                    </div>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Image Translation">
              <h2>Image to Image Translation</h2>
              <p>
                Rather than starting with random noise, we can start with a
                noisy base image and run iterative cfg to get variations from
                our base image. This is done by running the forward noising
                process and running the previous algorithm on the noisy image.
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="--grid-cols: repeat(6, 1fr)"
                >
                  <figure>
                    <img
                      src="./media/im_translation/t_1.png"
                      alt="Image Translation t1"
                      loading="lazy"
                    />
                    <figcaption>$t = 1$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/im_translation/t_3.png"
                      alt="Image Translation t3"
                      loading="lazy"
                    />
                    <figcaption>$t = 3$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/im_translation/t_5.png"
                      alt="Image Translation t5"
                      loading="lazy"
                    />
                    <figcaption>$t = 5$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/im_translation/t_7.png"
                      alt="Image Translation t7"
                      loading="lazy"
                    />
                    <figcaption>$t = 7$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/im_translation/t_10.png"
                      alt="Image Translation t10"
                      loading="lazy"
                    />
                    <figcaption>$t = 10$</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/im_translation/t_20.png"
                      alt="Image Translation t20"
                      loading="lazy"
                    />
                    <figcaption>$t = 20$</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Hand-Drawn/Web Images">
              <h2>Editing Hand-Drawn/Web Images</h2>
              <p>We can also denoise hand-drawn and web images:</p>
              <div class="centered">
                <div class="carousel-container" id="carousel2">
                  <button class="carousel-button" onclick="shiftLeft(2)">
                    &#9664;
                  </button>
                  <div
                    class="image-container"
                    style="--grid-cols: repeat(5, 1fr)"
                  >
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_1.png"
                      alt="Web Edit t1"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_3.png"
                      alt="Web Edit t3"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_5.png"
                      alt="Web Edit t5"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_7.png"
                      alt="Web Edit t7"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_10.png"
                      alt="Web Edit t10"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/t_20.png"
                      alt="Web Edit t20"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/web_edits/original.png"
                      alt="Base Image"
                      loading="lazy"
                    />
                  </div>
                  <button class="carousel-button" onclick="shiftRight(2)">
                    &#9654;
                  </button>
                </div>

                <div class="carousel-container" id="carousel3">
                  <button class="carousel-button" onclick="shiftLeft(3)">
                    &#9664;
                  </button>
                  <div
                    class="image-container"
                    style="--grid-cols: repeat(5, 1fr)"
                  >
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_1.png"
                      alt="Hand-Drawn Edit t1"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_3.png"
                      alt="Hand-Drawn Edit t3"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_5.png"
                      alt="Hand-Drawn Edit t5"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_7.png"
                      alt="Hand-Drawn Edit t7"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_10.png"
                      alt="Hand-Drawn Edit t10"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/t_20.png"
                      alt="Hand-Drawn Edit t20"
                      loading="lazy"
                    />
                    <img
                      class="carousel-image"
                      src="./media/hand_drawn_edits/original.png"
                      alt="Base Image"
                      loading="lazy"
                    />
                  </div>
                  <button class="carousel-button" onclick="shiftRight(3)">
                    &#9654;
                  </button>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Inpainting">
              <h2>Inpainting</h2>
              <p>
                We can also inpaint an image given the work done so far. Rather
                than subtracting out the noise calculated at each step from our
                entire image, we only subtract out the calculated noise in a
                section of our image. This means that for all noise outside the
                area we want to inpaint, we replace it with the original image
                processed through the forward noising function.
              </p>
              <div class="centered">
                <div class="carousel-container" id="carousel4">
                  <button class="carousel-button" onclick="shiftLeft(4)">
                    &#9664;
                  </button>
                  <div
                    class="image-container"
                    style="--grid-cols: repeat(5, 1fr); width: 100%"
                  >
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_1.png"
                        alt="Campanile Inpaint 1"
                        loading="lazy"
                      />
                      <figcaption>$t=990$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_2.png"
                        alt="Campanile Inpaint 2"
                        loading="lazy"
                      />
                      <figcaption>$t=840$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_3.png"
                        alt="Campanile Inpaint 3"
                        loading="lazy"
                      />
                      <figcaption>$t=690$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_4.png"
                        alt="Campanile Inpaint 4"
                        loading="lazy"
                      />
                      <figcaption>$t=540$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_5.png"
                        alt="Campanile Inpaint 5"
                        loading="lazy"
                      />
                      <figcaption>$t=390$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_6.png"
                        alt="Campanile Inpaint 6"
                        loading="lazy"
                      />
                      <figcaption>$t=240$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_7.png"
                        alt="Campanile Inpaint 7"
                        loading="lazy"
                      />
                      <figcaption>$t=90$</figcaption>
                    </figure>
                    <figure class="carousel-image">
                      <img
                        src="./media/inpainting/denoise_8.png"
                        alt="Campanile Inpaint 8"
                        loading="lazy"
                      />
                      <figcaption>$t=0$</figcaption>
                    </figure>
                  </div>
                  <button class="carousel-button" onclick="shiftRight(4)">
                    &#9654;
                  </button>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Text Conditional Translation">
              <h2>Text Conditional Image to Image Translation</h2>
              <p>
                Rather than keeping the prompt set to "a high quality photo", we
                can replace it with a text prompt from the prompt embedding.
                This means that rather than denoising unconditionally, we
                denoise based on the prompt given, which will give the image a
                push towards what is specified by the prompt.
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="--grid-cols: repeat(6, 1fr)"
                >
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_1/denoise_8.png"
                        alt="Campanile Translation Rocket t_1"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_1/output.gif"
                        alt="Campanile Translation Rocket t_1 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 1$</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_2/denoise_8.png"
                        alt="Campanile Translation Rocket t_2"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_2/output.gif"
                        alt="Campanile Translation Rocket t_2 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 3$</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_3/denoise_8.png"
                        alt="Campanile Translation Rocket t_3"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_3/output.gif"
                        alt="Campanile Translation Rocket t_3 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 5$</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_4/denoise_7.png"
                        alt="Campanile Translation Rocket t_4"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_4/output.gif"
                        alt="Campanile Translation Rocket t_4 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 7$</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_5/denoise_7.png"
                        alt="Campanile Translation Rocket t_5"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_5/output.gif"
                        alt="Campanile Translation Rocket t_5 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 10$</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-margin: 0;
                      "
                    >
                      <img
                        class="dissolve"
                        src="./media/text_conditioned/t_6/denoise_5.png"
                        alt="Campanile Translation Rocket t_6"
                        onmouseover="resetSiblingGif(this)"
                        loading="lazy"
                      />
                      <img
                        class="emerge"
                        src="./media/text_conditioned/t_6/output.gif"
                        alt="Campanile Translation Rocket t_6 gif"
                        loading="lazy"
                      />
                    </div>
                    <figcaption>$t = 20$</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                We see that the images look more similar to the base image
                (Campanile) when we start off with less noise, but still
                resembles a rocket, which was the prompt embed used.
              </p>
            </article>
          </section>
          <section>
            <article id="Visual Anagrams">
              <h2>Visual Anagrams</h2>
              <p>
                We can also flip the image at each step, denoise and flip it
                back to make a separate denoising step towards a different
                prompt embed. This allows us to make a flip illusion, where
                flipping the image reveals a hidden image. Hover over the images
                to visualize the result:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(4, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/flip_illusion/i1/denoise_9.png"
                      alt="Flip Illusion Skull, Waterfall"
                      class="flip"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Waterfall</figcaption>
                    <figcaption class="emerge">A Skull</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/flip_illusion/i2/denoise_9.png"
                      alt="Flip Illusion Man, Campfire"
                      class="flip"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Campfire</figcaption>
                    <figcaption class="emerge">A Man</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/flip_illusion/i3/denoise_9.png"
                      alt="Flip Illusion Man with Hat, Campfire"
                      class="flip"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Campfire</figcaption>
                    <figcaption class="emerge">A Man Wearing a Hat</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/flip_illusion/i4/denoise_9.png"
                      alt="Flip Illusion Dog, Snow Mountain"
                      class="flip"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Snowy Village</figcaption>
                    <figcaption class="emerge">A Dog</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Hybrid Images">
              <h2>Hybrid Images</h2>
              <p>
                A hybrid image is one where one subject in an image dominates
                when viewed up close and a different one dominates when viewed
                afar. We can again modify the noise added, this time taking the
                low frequencies of the predicted noise from one prompt embedding
                and adding it to the high frequencies of a different prompt
                embedding. Hover over the images to see the result:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(3, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/hybrid/skull_waterfall/denoise_9.png"
                      alt="Skull Waterfall hybrid"
                      class="zoom-out"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Waterfall</figcaption>
                    <figcaption class="emerge">A Skull</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/hybrid/skull_winter/denoise_9.png"
                      alt="Skull Snow Mountain hybrid"
                      class="zoom-out"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Snow Mountain</figcaption>
                    <figcaption class="emerge">A Skull</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/hybrid/pencil_snow/denoise_9.png"
                      alt="Pencil Snow Mountain hybrid"
                      class="zoom-out"
                      loading="lazy"
                    />
                    <figcaption class="dissolve">A Snowy Village</figcaption>
                    <figcaption class="emerge">A Pencil</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Unconditional Unet">
              <h2>Unconditional Unet</h2>
              <p>
                The unet is a convolutional network designed to output images
                from an input of a images. In the downward part of the net, we
                run the images through convolution and max pooling layers to
                increase the perception of the network. Going back up, we want
                to recover our image, so we add concatenations with information
                from our previous layers.
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(1, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/unconditional_unet/architecture.png"
                      alt="unet architecture"
                    />
                    <figcaption>Unet Design</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                In a one step denoising process, we can use our unet to directly
                predict the clean image from a noisy input. To train the
                unconditional network, we fix the noise level to $\sigma = 0.5$
                and noise an image by the given formula: \begin{equation*} x =
                x_{0} + \varepsilon \end{equation*} where \begin{equation*}
                \varepsilon \sim \mathcal{N}(0, \sigma^{2}) \end{equation*} We
                feed $x$ into the network and estimate the loss between
                $\hat{x}$ and $x_{0}$
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(1, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/unconditional_unet/loss.png"
                      alt="Unconditional Unet Loss"
                      loading="lazy"
                    />
                    <figcaption>After 5 epochs</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                Here are some results, where the clean image is on the left, the
                noisy image is on the middle, and the predicted image is on the
                right of each figure:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(2, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/unconditional_unet/epoch_1.png"
                      alt="Epoch 1 Denoise"
                      loading="lazy"
                    />
                    <figcaption>Epoch 1 Denoising</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/unconditional_unet/epoch_5.png"
                      alt="Epoch 5 Denoise"
                      loading="lazy"
                    />
                    <figcaption>Epoch 5 Denoising</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                The unconditional unet does not do very well with higher noise
                levels, as there was no input on the amount of noise in our
                training. From left to right, the model was given images with
                noise levels of $0.0, 0.2, 0.4, 0.6, 0.8, $ and $1.0$
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(1, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/unconditional_unet/sampling_1.png"
                      alt="Various noise level denoisings"
                      loading="lazy"
                    />
                    <figcaption>Epoch 1 Denoising</figcaption>
                  </figure>
                  <figure>
                    <img
                      src="./media/unconditional_unet/sampling_5.png"
                      alt="Various noise level denoisings"
                      loading="lazy"
                    />
                    <figcaption>Epoch 5 Denoising</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
          <section>
            <article id="Conditional Unet">
              <h2>Conditional Unet</h2>
              <p>
                In a conditional unet, more information is given to the model
                and perform the denoising iteratively for better results. We
                define a new one step noising process: \begin{equation*} x_{t} =
                \sqrt{1 - \overline{\alpha_{t}}}x_{0} +
                \sqrt{\overline{\alpha_{t}}}\varepsilon \end{equation*} where
                \begin{equation*} \varepsilon \sim \mathcal{N}(0, I)
                \end{equation*} We want to predict the cleaner image given a
                noisy image and this is given by some function of $x_{t},
                x_{0}$: \begin{equation*} p(x_{t - 1} \mid x_{t}) =
                \mathcal{N}(\mu_{t}(x_{t}, x_{0}), \tilde{\beta} I)
                \end{equation*} so \begin{equation*} x_{t - 1} =
                \dfrac{\sqrt{\overline{\alpha_{t - 1}}}\beta_{t}}{1 -
                \overline{\alpha_{t}}}x_{0} + \dfrac{\sqrt{\alpha_{t}}(1 -
                \overline{\alpha}_{t - 1})}{1 - \overline{\alpha}_{t}}x_{t} +
                \tilde{\beta}_{t}z, \, \tilde{\beta}_{t} = \dfrac{1 -
                \overline{\alpha}_{t - 1}}{1 - \overline{\alpha}_{t}}\beta_{t}
                \end{equation*} We define our $\beta_{t}$ as linear in $[0,
                999]$, $\overline{\alpha}_{t} = 1 - \beta_{t}$ and $\alpha_{t} =
                \prod_{i = 0}^{t}\overline{\alpha}_{i}$. This gives us a way to
                recover a cleaner image $x_{t - 1}$ in terms of the predicted
                noise $\hat{\varepsilon}$ and $x_{t}$.
              </p>
              <p>
                We first update the architecture by embedding the time and label
                of the training data. This is done by running both these through
                a linear layer, gelu, then another linear layer. We do this two
                times and embed at the unflatten layer and up convolve layer:
              </p>
              \begin{equation*} x = c \cdot x + t \end{equation*}
              <p>
                The forward process in the conditional unet is mostly the same.
                We add noise given by our new one step noising process. A mask
                is also created with a certain probability to run unconditioned
                predictions to make the model more flexible. Instead of
                predicting the clean image, the model will predict the noise and
                we update it based on $MSE(\hat{\varepsilon}, \varepsilon)$
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(1, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <img
                      src="./media/conditional_unet/loss.png"
                      alt="Conditional Unet Loss"
                      loading="lazy"
                    />
                    <figcaption>After 20 Epochs</figcaption>
                  </figure>
                </div>
              </div>
              <p>
                In the sampling/denoising process, we iteratively predict the
                cleaner image given the formula for $x_{t - 1}$ calculated
                above. Hover over the images to see the denoising in action:
              </p>
              <div class="centered">
                <div
                  class="image-container"
                  style="
                    --grid-cols: repeat(1, 1fr);
                    --image-container-width: 40rem;
                  "
                >
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-width: 40rem;
                      "
                    >
                      <img
                        src="./media/conditional_unet/sampling1.jpeg"
                        alt="Conditional Unet Sampling 1 jpeg"
                        loading="lazy"
                        onmouseover="resetSiblingGif(this)"
                        class="dissolve"
                      />
                      <img
                        src="./media/conditional_unet/sampling1.gif"
                        alt="Conditional Unet Sampling 1"
                        loading="lazy"
                        class="emerge"
                      />
                    </div>
                    <figcaption>Epoch 1</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-width: 40rem;
                      "
                    >
                      <img
                        src="./media/conditional_unet/sampling5.jpeg"
                        alt="Conditional Unet Sampling 5 jpeg"
                        loading="lazy"
                        onmouseover="resetSiblingGif(this)"
                        class="dissolve"
                      />
                      <img
                        src="./media/conditional_unet/sampling5.gif"
                        alt="Conditional Unet Sampling 5"
                        loading="lazy"
                        class="emerge"
                      />
                    </div>
                    <figcaption>Epoch 5</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-width: 40rem;
                      "
                    >
                      <img
                        src="./media/conditional_unet/sampling10.jpeg"
                        alt="Conditional Unet Sampling 10 jpeg"
                        loading="lazy"
                        onmouseover="resetSiblingGif(this)"
                        class="dissolve"
                      />
                      <img
                        src="./media/conditional_unet/sampling10.gif"
                        alt="Conditional Unet Sampling 10"
                        loading="lazy"
                        class="emerge"
                      />
                    </div>
                    <figcaption>Epoch 10</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-width: 40rem;
                      "
                    >
                      <img
                        src="./media/conditional_unet/sampling15.jpeg"
                        alt="Conditional Unet Sampling 15 jpeg"
                        loading="lazy"
                        onmouseover="resetSiblingGif(this)"
                        class="dissolve"
                      />
                      <img
                        src="./media/conditional_unet/sampling15.gif"
                        alt="Conditional Unet Sampling 15"
                        loading="lazy"
                        class="emerge"
                      />
                    </div>
                    <figcaption>Epoch 15</figcaption>
                  </figure>
                  <figure>
                    <div
                      class="image-container"
                      style="
                        --grid-cols: repeat(1, 1fr);
                        --image-container-width: 40rem;
                      "
                    >
                      <img
                        src="./media/conditional_unet/sampling20.jpeg"
                        alt="Conditional Unet Sampling 20 jpeg"
                        loading="lazy"
                        onmouseover="resetSiblingGif(this)"
                        class="dissolve"
                      />
                      <img
                        src="./media/conditional_unet/sampling20.gif"
                        alt="Conditional Unet Sampling 20"
                        loading="lazy"
                        class="emerge"
                      />
                    </div>
                    <figcaption>Epoch 20</figcaption>
                  </figure>
                </div>
              </div>
            </article>
          </section>
        </main>
      </div>

      <footer></footer>
    </div>
  </body>
</html>
